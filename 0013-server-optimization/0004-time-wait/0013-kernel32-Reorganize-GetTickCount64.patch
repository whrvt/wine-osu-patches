From: William Horvath <william@horvath.blog>
Date: Sun, 13 Oct 2024 20:23:16 -0700
Subject: [PATCH] kernel32: Reorganize GetTickCount64.

diff --git a/dlls/kernel32/sync.c b/dlls/kernel32/sync.c
index 11111111111..11111111111 100644
--- a/dlls/kernel32/sync.c
+++ b/dlls/kernel32/sync.c
@@ -82,16 +82,7 @@ static BOOL get_open_object_attributes( OBJECT_ATTRIBUTES *attr, UNICODE_STRING
  */
 ULONGLONG WINAPI DECLSPEC_HOTPATCH GetTickCount64(void)
 {
-    ULONG high, low;
-
-    do
-    {
-        high = user_shared_data->TickCount.High1Time;
-        low = user_shared_data->TickCount.LowPart;
-    }
-    while (high != user_shared_data->TickCount.High2Time);
-    /* note: we ignore TickCountMultiplier */
-    return (ULONGLONG)high << 32 | low;
+    return __atomic_load_n( &user_shared_data->TickCountQuad, __ATOMIC_ACQUIRE );
 }
 
 /***********************************************************************
-- 
0.0.0

