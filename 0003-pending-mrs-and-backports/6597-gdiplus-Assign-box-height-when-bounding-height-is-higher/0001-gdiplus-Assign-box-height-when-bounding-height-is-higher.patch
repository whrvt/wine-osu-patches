From 5498e9c12b61df789708ec995fd1abec965475f1 Mon Sep 17 00:00:00 2001
From: Santino Mazza <smazza@codeweavers.com>
Date: Tue, 1 Oct 2024 12:10:25 -0300
Subject: [PATCH] gdiplus: Assign box height when bounding height is higher.

---
 dlls/gdiplus/graphics.c       | 2 +-
 dlls/gdiplus/tests/graphics.c | 1 -
 2 files changed, 1 insertion(+), 2 deletions(-)

diff --git a/dlls/gdiplus/graphics.c b/dlls/gdiplus/graphics.c
index f7559201c59..9e9e7fe0df9 100644
--- a/dlls/gdiplus/graphics.c
+++ b/dlls/gdiplus/graphics.c
@@ -5602,7 +5602,7 @@ GpStatus gdip_format_string(GpGraphics *graphics, HDC hdc,
         {
             if (format->attr & StringFormatFlagsLineLimit)
                 break;
-            bounds.Height = nheight - (height + size.cy);
+            bounds.Height = nheight;
         }
         else
             bounds.Height = size.cy;
diff --git a/dlls/gdiplus/tests/graphics.c b/dlls/gdiplus/tests/graphics.c
index a7efec723ab..dd25dd54fb2 100644
--- a/dlls/gdiplus/tests/graphics.c
+++ b/dlls/gdiplus/tests/graphics.c
@@ -4677,7 +4677,6 @@ static void test_measure_string(void)
     expectf(0.0, bounds.X);
     expectf(0.0, bounds.Y);
     expectf(width, bounds.Width);
-    todo_wine
     expectf(height / 2.0, bounds.Height);
 
     range.First = 0;
-- 
GitLab

