From 7fa28a9fc7df7c2449e17636320b0ebfe0146540 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Sun, 18 Aug 2024 12:36:20 +0200
Subject: [PATCH 12/24] winewayland: Get rid of window_surface reference from
 wayland_win_data.

---
 dlls/winewayland.drv/waylanddrv.h | 2 --
 dlls/winewayland.drv/window.c     | 5 -----
 2 files changed, 7 deletions(-)

diff --git a/dlls/winewayland.drv/waylanddrv.h b/dlls/winewayland.drv/waylanddrv.h
index d58e6696910..c717838cefa 100644
--- a/dlls/winewayland.drv/waylanddrv.h
+++ b/dlls/winewayland.drv/waylanddrv.h
@@ -289,8 +289,6 @@ struct wayland_win_data
     struct wayland_surface *wayland_surface;
     /* wayland client surface (if any) for this window */
     struct wayland_client_surface *client_surface;
-    /* wine window_surface backing this window */
-    struct window_surface *window_surface;
     /* window rects, relative to parent client area */
     struct window_rects rects;
     BOOL managed;
diff --git a/dlls/winewayland.drv/window.c b/dlls/winewayland.drv/window.c
index c8a75250a89..759d6f48dbc 100644
--- a/dlls/winewayland.drv/window.c
+++ b/dlls/winewayland.drv/window.c
@@ -119,7 +119,6 @@ static void wayland_win_data_destroy(struct wayland_win_data *data)
 
     pthread_mutex_unlock(&win_data_mutex);
 
-    if (data->window_surface) window_surface_release(data->window_surface);
     if (data->wayland_surface) wayland_surface_destroy(data->wayland_surface);
     if (data->window_contents) wayland_shm_buffer_unref(data->window_contents);
     free(data);
@@ -444,10 +443,6 @@ void WAYLAND_WindowPosChanged(HWND hwnd, HWND insert_after, UINT swp_flags, cons
     data->rects = *new_rects;
     data->managed = managed;
 
-    if (surface) window_surface_add_ref(surface);
-    if (data->window_surface) window_surface_release(data->window_surface);
-    data->window_surface = surface;
-
     wayland_win_data_update_wayland_surface(data);
     if (surface) wayland_window_surface_set_visible_rect(surface, &data->rects.visible);
     if (data->wayland_surface) wayland_win_data_update_wayland_state(data);
-- 
2.46.0

