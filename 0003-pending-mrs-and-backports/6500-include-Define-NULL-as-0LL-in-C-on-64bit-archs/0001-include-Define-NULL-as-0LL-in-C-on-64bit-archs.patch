From 458b4080cbdb87f8b7dd2219aab3ebf0b71142da Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Sat, 7 Sep 2024 13:15:39 +0200
Subject: [PATCH] include: Define NULL as 0LL in C++ on 64bit archs.

Fixes incorrect value size being pushed to the stack when NULL is used
as a sentinel in a varargs function.
---
 include/msvcrt/corecrt.h | 6 +++++-
 include/windef.h         | 6 +++++-
 2 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/include/msvcrt/corecrt.h b/include/msvcrt/corecrt.h
index 945d8ac4055..d2e8482a44b 100644
--- a/include/msvcrt/corecrt.h
+++ b/include/msvcrt/corecrt.h
@@ -76,7 +76,11 @@
 
 #ifndef NULL
 #ifdef __cplusplus
-#define NULL  0
+#ifndef _WIN64
+#define NULL 0
+#else
+#define NULL 0LL
+#endif
 #else
 #define NULL  ((void *)0)
 #endif
diff --git a/include/windef.h b/include/windef.h
index 79a96791151..f8438f82c83 100644
--- a/include/windef.h
+++ b/include/windef.h
@@ -186,7 +186,11 @@ extern "C" {
 
 #undef NULL
 #ifdef __cplusplus
-#define NULL  0
+#ifndef _WIN64
+#define NULL 0
+#else
+#define NULL 0LL
+#endif
 #else
 #define NULL  ((void*)0)
 #endif
-- 
GitLab

