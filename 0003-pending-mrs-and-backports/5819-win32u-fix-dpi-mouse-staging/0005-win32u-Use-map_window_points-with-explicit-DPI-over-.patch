From 85c888b8dbab78638b5eaadabf5d431a6678a4e7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Thu, 13 Jun 2024 10:04:44 +0200
Subject: [PATCH 5/8] win32u: Use map_window_points with explicit DPI over
 screen_to_client.

---
 dlls/win32u/message.c | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/dlls/win32u/message.c b/dlls/win32u/message.c
index d537a75aea5..d0e884daa9a 100644
--- a/dlls/win32u/message.c
+++ b/dlls/win32u/message.c
@@ -2470,12 +2470,11 @@ static BOOL process_mouse_message( MSG *msg, UINT hw_id, ULONG_PTR extra_info, H
             message += WM_NCMOUSEMOVE - WM_MOUSEMOVE;
             wparam = hittest;
         }
-        else
+        /* coordinates don't get translated while tracking a menu */
+        /* FIXME: should differentiate popups and top-level menus */
+        else if (!(info->flags & GUI_INMENUMODE))
         {
-            /* coordinates don't get translated while tracking a menu */
-            /* FIXME: should differentiate popups and top-level menus */
-            if (!(info->flags & GUI_INMENUMODE))
-                screen_to_client( msg->hwnd, &pt );
+            map_window_points( 0, msg->hwnd, &pt, 1, get_dpi_for_window( msg->hwnd ) );
         }
     }
     msg->lParam = MAKELONG( pt.x, pt.y );
-- 
2.46.0

