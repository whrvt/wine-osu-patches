From b6a2c14777b521fd1a38ce718c5d8cead91968ef Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?R=C3=A9mi=20Bernon?= <rbernon@codeweavers.com>
Date: Sat, 29 Mar 2025 09:31:05 +0100
Subject: [PATCH] winex11: Only set focus_time_prop for managed windows.

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=58038
---
 dlls/winex11.drv/window.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/dlls/winex11.drv/window.c b/dlls/winex11.drv/window.c
index 51b64e8e83c..fe39cf510f8 100644
--- a/dlls/winex11.drv/window.c
+++ b/dlls/winex11.drv/window.c
@@ -1433,7 +1433,7 @@ static void window_set_wm_state( struct x11drv_win_data *data, UINT new_state )
         break;
     }
 
-    if (new_state == NormalState) NtUserSetProp( data->hwnd, focus_time_prop, (HANDLE)-1 );
+    if (new_state == NormalState && data->managed) NtUserSetProp( data->hwnd, focus_time_prop, (HANDLE)-1 );
 
     data->pending_state.wm_state = new_state;
     data->wm_state_serial = NextRequest( data->display );
-- 
GitLab

