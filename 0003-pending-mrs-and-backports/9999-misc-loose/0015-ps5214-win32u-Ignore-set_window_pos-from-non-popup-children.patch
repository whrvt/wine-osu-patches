From c962b4e60906c2605bc79f7298c69fdd43ca77a2 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Rafa=C5=82=20Kucharski?= <vaxry@vaxry.net>
Date: Sat, 2 Mar 2024 21:57:39 +0000
Subject: [PATCH] win32u: Ignore set_window_pos from non-popup children
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Windows ignores those requests. Fixes bug #20190

Signed-off-by: Rafa≈Ç Kucharski <vaxry@vaxry.net>
---
 dlls/win32u/window.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/dlls/win32u/window.c b/dlls/win32u/window.c
index 69dd8caba5d..ad2b62dcfde 100644
--- a/dlls/win32u/window.c
+++ b/dlls/win32u/window.c
@@ -3410,6 +3410,14 @@ BOOL set_window_pos( WINDOWPOS *winpos, int parent_x, int parent_y )
         }
     }
 
+    if (winpos->hwndInsertAfter == HWND_TOPMOST || winpos->hwndInsertAfter == HWND_NOTOPMOST)
+    {
+        /* Fixes bug #20190, Windows ignores these windows' geometry sets */
+        DWORD style = get_window_long(winpos->hwnd, GWL_STYLE);
+        
+        if ((style & (WS_POPUP | WS_CHILD)) == WS_CHILD) return TRUE;
+    }
+
     /* Make sure that coordinates are valid for WM_WINDOWPOSCHANGING */
     if (!(winpos->flags & SWP_NOMOVE))
     {
-- 
GitLab

